
# SmartVoucher

Validation rule of SmartVoucher BE

1. Warehouse: 
- Một warehouse chỉ chứa 1 loại discount type. Không cho phép đổi loại discount type 
- Cho phép điều chỉnh tăng capacity của warehouse. Số lượng điều chỉnh tăng = số lượng serial được generate 
VD: WH đang có capacity = 100. Điều chỉnh tăng capacity = 200 -> có thể tạo thêm mới 100 serial và nhập vào WH này 


2. Serial 
- Thời hạn valid của serial dựa vào effective from - to của warehouse. wh_effective_from <=valid_time_of_serial <= wh_effective_to
- Rule generate serial: độ dài serial fix = 10 kí tự, bao gồm A-Z và 0-9. Serial gen random, không được generate serial theo pattern tăng dần để tránh cheating
- Số lượng serial có thể gen: max = capacity của wh
- Đối với wh đã có serial nhập kho, số lượng serial có thể gen = capacity của WH - số lượng serial đã nhập kho. VD: WH có capacity = 100, đã nhập kho: 50 -> số lượng serial có thể gen mới và nhập kho = 50 cái
- Khi generate serial, bắt buộc phải chỉ định warehouse cho serial đó
- Serial là unique trên toàn hệ thống voucher 
- Serial sẽ có các stt new, owned (khi user đã mua), used (user đã dùng), expired (hết hạn - tính theo effective time của warehouse)

3. Order
- Khi tạo order, kiểm tra stt && remaining_serial && effective time của warehouse. 
+ wh_stt = active -> allow to place order
+ wh_remaining_serial >0. wh_remaining_serial = capacity - số lượng serial đã bán
+ wh_effective_from <= order_time <= wh_effective_to -> allow to place order


4. Ticket
- Ticket sẽ có các stt: owned (khi user đã mua), used (user đã dùng), expired (hết hạn - tính theo effective time của warehouse)

5. Ticket_history: 
- Mỗi sự kiện sẽ cần ghi nhận lại một dòng data ở db. VD khi ticket có stt = owned, ghi nhận 1 record. Khi user sử dụng, ghi nhận thêm 1 dòng record

